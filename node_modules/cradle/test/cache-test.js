var cradle = require('cradle'),
        sys = require('sys')
        fs = require('fs');
 
// Defaults to 127.0.0.1:5984
var conn = new(cradle.Connection)();
var db = conn.database('gadgets');
 
// NOTE: Update this to an id in your database
var kindleDocId = 'f9e7cb78abf9fc41e03f6101ab005c2d';
/*
db.save(kindleDocId, {name: 'Kindle3', company: 'Amazon', ceo: 'Jeff Bezos'}, function (err, res) {
  db.get(kindleDocId, function (err, doc) {
      sys.puts('Updated: ' + doc);
  });
});
*/
//console.log(db);

/*
db.get(kindleDocId, function (err, doc) {
      if(err){
        console.log(err);
      }else{
      
      console.log(doc);
      db.saveAttachment( 
          doc._id,
          doc._rev,
          'package.json',
          'application/json',
          fs.createReadStream('package.json'),
          function( err, data ){
            if(err){
              console.log(err);
            }else{
            console.log(data);
            }
          }
      );
      }
});
*/


var response = {};
var streamer = db.getAttachment(kindleDocId,'icon.png');
                            streamer.addListener('response', function (res) {
                                response.headers = res.headers;
                                response.headers.status = res.statusCode;
                                response.body = "";
                            });
                            streamer.addListener('data', function (chunk) { response.body += chunk; });
                            streamer.addListener('end', function () {
                              console.log("ENDE DENE",response);
                              fs.writeFile('icon.png', response.body, function (err) {
                                if (err) throw err;
                                console.log('It\'s saved!');
                              });
                            });





//console.log(db.getAttachment(kindleDocId,'apple-touch-icon.png'));
